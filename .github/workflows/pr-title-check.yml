name: PR Title Check
on:
  pull_request:
    types: [opened, edited, synchronize]

jobs:
  check-title:
    runs-on: ubuntu-latest
    steps:
      - name: Check PR Title Format
        run: |
          title="${{ github.event.pull_request.title }}"

          echo "üîç Checking PR title: '$title'"

          # Check if title starts with valid type
          valid_types="feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert"

          if [[ $title =~ ^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert) ]]; then
            echo "‚úÖ Valid type found"
          else
            echo "‚ùå PR title must start with a valid type"
            echo "Valid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert"
            echo "Example: feat: add new feature"
            exit 1
          fi

          # Check if it has colon and description
          if [[ $title =~ : ]]; then
            echo "‚úÖ Has description after colon"
          else
            echo "‚ùå PR title must have format: type: description or type(scope): description"
            exit 1
          fi

          # Extract scope if it exists (between parentheses)
          if [[ $title =~ \(([^)]+)\) ]]; then
            scope_part="${BASH_REMATCH[1]}"
            echo "üì¶ Found scope(s): $scope_part"

            # Check each scope (split by comma)
            valid_scopes="design-system-docs|eds-color-palette-generator|eds-core-react|eds-data-grid-react|eds-demo|eds-icons|eds-lab-react|eds-tailwind|eds-tokens|eds-tokens-build|eds-tokens-sync|eds-utils|figma-broker"

            # Replace commas with spaces and check each scope
            scopes_to_check=$(echo "$scope_part" | tr ',' ' ')

            for scope in $scopes_to_check; do
              # Trim whitespace
              scope=$(echo "$scope" | sed 's/^[ \t]*//;s/[ \t]*$//')
              echo "  - Checking scope: '$scope'"

              if [[ $scope =~ ^(design-system-docs|eds-color-palette-generator|eds-core-react|eds-data-grid-react|eds-demo|eds-icons|eds-lab-react|eds-tailwind|eds-tokens|eds-tokens-build|eds-tokens-sync|eds-utils|figma-broker)$ ]]; then
                echo "    ‚úÖ Valid scope"
              else
                echo "    ‚ùå Invalid scope: '$scope'"
                echo ""
                echo "Valid scopes: design-system-docs, eds-color-palette-generator, eds-core-react,"
                echo "eds-data-grid-react, eds-demo, eds-icons, eds-lab-react, eds-tailwind,"
                echo "eds-tokens, eds-tokens-build, eds-tokens-sync, eds-utils, figma-broker"
                exit 1
              fi
            done

            echo "‚úÖ All scopes are valid"
          else
            echo "üì¶ No scope specified (optional)"
          fi

          echo "‚úÖ PR title follows conventional commit format!"
