
import { Links, Story, PropsTable } from './../../../.storybook/components'
import * as icons from '@equinor/eds-icons'

# Autocomplete 

Allows users to choose one or multiple options from a list. The component is built using [Downshift](https://github.com/downshift-js/downshift).

<Links 
    sourceUrl="https://github.com/equinor/design-system/blob/develop/packages/eds-core-react/src/components/Autocomplete/Autocomplete.tsx"
    npmUrl="https://www.npmjs.com/package/@equinor/eds-core-react"
/>

<Story id="inputs-autocomplete--introduction" />
<PropsTable />

## Usage

The value must be chosen from a predefined list of values.

```tsx
import { Autocomplete } from '@equinor/eds-core-react'

const options = [
  'Microsoft Corporation',
   'Tesla, Inc',
   'Apple Inc.',
]

<Autocomplete 
  label="Stocks"
  options={options}
/>
```

When passing in objects as options, make sure you define the `optionLabel` function for wanted label. This function must return a string.

```tsx

const options = [
   { label: 'Microsoft Corporation', symbol: 'MSFT' },
   { label: 'Tesla, Inc', symbol: 'TSLA' },
   { label: 'Apple Inc.', symbol: 'AAPL'},
]

<Autocomplete 
  label="Stocks"
  options={options}
  optionLabel={(option) => option.label}
/>
```

## Accessibility

### ARIA
The property <code>label</code> is mandatory and makes sure you have a descriptive label for screen readers.

## Examples

### Multiple
Enable the `multiple` property for multiple selection of values.
<Story id="inputs-autocomplete--multiple" />

### Objects as options
If the options-list contains objects and not strings, you must define the `optionLabel` function to specify
how the label should be rendered and searched for. This function must return a string.

<Story id="inputs-autocomplete--option-label" />

### Customized option component
Use `optionComponent` to render custom item templates. `optionLabel` is required here as it is still needed internally for filtering and what to show in the input as selected option. `multiline` should also be included to allow dynamic height of items.

<Story id="inputs-autocomplete--option-component" />

### Controlled
Autocomplete controls its own state internally, and calls your `onOptionsChange` handler when the state changes. You can use `initialSelectedOptions`
to define pre-selected options.

If you instead want to control your own state, you can use the `selectedOptions` prop to pass your controlled data. The initial value can be an 
empty array if no elements are to be pre-selected. Use `onOptionsChange` to handle changes in selection. 

The controlled state is provided from `downshift`. You can read more about it [in the downshift documentation](https://github.com/downshift-js/downshift#control-props).

<Story id="inputs-autocomplete--controlled" />

### Read only
Use prop `readOnly`

<Story id="inputs-autocomplete--read-only" />

### Disabled
Use prop `disabled`

<Story id="inputs-autocomplete--disabled" />

### Disabled option
You can disable specific options by sending an `optionDisabled` prop containing a function that 
will disable an option if satisfied.

<Story id="inputs-autocomplete--disabled-option" />


### Preselected options
For uncontrolled components, you can use `initialSelectedOptions` to define pre-selected options.
For controlled components, you can use the `selectedOptions` prop to pass your controlled data 
(see example on this under [Controlled](?path=/docs/inputs-autocomplete--controlled)).

<Story id="inputs-autocomplete--preselected-options" />

### Compact
Compact mode is toggled using [EdsProvider](?path=/docs/edsprovider--introduction).

Note that compact mode should come with the possibility to switch to normal mode for accessibility reasons.

<Story id="inputs-autocomplete--compact" />

### Custom options filter
The default search filter checks against the option label. For special cases, you can specify a custom filter by setting 
the `optionsFilter` callback. This is for instace useful for searching for an abbreviation for the label.

This feature should be used with caution: If the search phrase produces results that look different from what was searched for, 
it may be confusing for the users, so ideally the search phrase should be included in the label.

<Story id="inputs-autocomplete--custom-options-filter" />

### Adjusting dropdown width
If `autoWidth` is set to `true`, the dropdown width will be the same as the width of the input. 
Otherwise, the dropdown width will be based on its widest content.

The prop `multiline` lets you wrap long texts into multiple lines, as you can see in the second input.

<Story id="inputs-autocomplete--auto-width" />

### Virtualization
`Autocomplete` uses [@tanstack/react-virtual](https://tanstack.com/virtual/v3) virtualization to support large datasets.

<Story id="inputs-autocomplete--virtualized" />

### Async search autocomplete
`Autocomplete` supports async search-as-you-type use cases. You may want to disable local filtering (when this is already handled serverside) with `optionsFilter={() => true}`. `onInputChange` callback is used to call an api with the search query and `loading` is used to visually notify the user that data is being fetched. 

<Story id="inputs-autocomplete--async" />

### With `React Hook Form`

Example using [react-hook-form](https://react-hook-form.com/) library.
<Story id="inputs-autocomplete--with-react-hook-form" />

### With Select All option
This is an example of how to make a "Select All" option for quicker selection. 
Make sure to use `useMemo` if you are mutating the options in the render function to avoid object memory references bugs on re-renders.
<Story id="inputs-autocomplete--select-all" />

